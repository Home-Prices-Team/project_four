{"cells":[{"cell_type":"code","execution_count":1,"id":"d911c587-4753-47f4-92ef-2f5134f2f10e","metadata":{"id":"d911c587-4753-47f4-92ef-2f5134f2f10e","outputId":"655059c9-363c-415a-8b76-88992d560d98","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1743096761376,"user_tz":300,"elapsed":8814,"user":{"displayName":"Dereje Dimetros","userId":"13136209974486096002"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["Requirement already satisfied: pyspark in /usr/local/lib/python3.11/dist-packages (3.5.5)\n","Requirement already satisfied: py4j==0.10.9.7 in /usr/local/lib/python3.11/dist-packages (from pyspark) (0.10.9.7)\n"]}],"source":["!pip install pyspark"]},{"cell_type":"code","execution_count":2,"id":"378c90e2-53e5-4386-bbd7-820e4d708f04","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"378c90e2-53e5-4386-bbd7-820e4d708f04","executionInfo":{"status":"ok","timestamp":1743096770076,"user_tz":300,"elapsed":8702,"user":{"displayName":"Dereje Dimetros","userId":"13136209974486096002"}},"outputId":"f1650b99-8a4a-4a2b-bc04-f8db0fe53c32"},"outputs":[{"output_type":"stream","name":"stderr","text":["Downloading...\n","From: https://drive.google.com/uc?id=1cl3UhRSTLQ3L4d4AdE1aWOqEak99nmri\n","To: /content/cleaned_completed_data.csv\n","100%|██████████| 30.6M/30.6M [00:00<00:00, 65.9MB/s]\n"]},{"output_type":"stream","name":"stdout","text":["Current working directory: /content\n","Full file path: cleaned_completed_data.csv\n","CSV Data Preview:\n","         date  index_sa  redfin_hpi_mom  case_shiller_index_mom  \\\n","0  2012-01-01      59.9             0.0               -0.000005   \n","1  2012-01-01      59.9             0.0               -0.000005   \n","2  2012-01-01      59.9             0.0               -0.000005   \n","3  2012-01-01      59.9             0.0               -0.000005   \n","4  2012-01-01      59.9             0.0               -0.000005   \n","\n","   period_duration region_type  table_id  is_seasonally_adjusted  \\\n","0               30       state        23                   False   \n","1               30       state        10                   False   \n","2               30       state        42                   False   \n","3               30       state        47                   False   \n","4               30       state        12                   False   \n","\n","          region          state  ... price_drops  price_drops_mom  \\\n","0       Oklahoma       Oklahoma  ...    0.000000         0.000000   \n","1  New Hampshire  New Hampshire  ...    0.000000         0.000000   \n","2       Virginia       Virginia  ...    0.000000         0.000000   \n","3       Michigan       Michigan  ...    0.000000         0.000000   \n","4     New Jersey     New Jersey  ...    0.000549         0.000005   \n","\n","   price_drops_yoy  off_market_in_two_weeks  off_market_in_two_weeks_mom  \\\n","0              0.0                 0.000000                     0.000000   \n","1              0.0                 0.007093                     0.000006   \n","2              0.0                 0.000000                     0.000000   \n","3              0.0                 0.013045                    -0.000005   \n","4              0.0                 0.007897                     0.000018   \n","\n","   off_market_in_two_weeks_yoy  30_year_%  price_drops_is_blank  \\\n","0                     0.000000      3.915                  True   \n","1                    -0.000002      3.915                  True   \n","2                     0.000000      3.915                  True   \n","3                     0.000007      3.915                  True   \n","4                     0.000061      3.915                 False   \n","\n","   price_drops_mom_is_blank  price_drops_yoy_is_blank  \n","0                      True                      True  \n","1                      True                      True  \n","2                      True                      True  \n","3                      True                      True  \n","4                     False                      True  \n","\n","[5 rows x 57 columns]\n"]}],"source":["import pandas as pd\n","import os\n","from pyspark.sql import SparkSession\n","import gdown # Import the gdown library\n","\n","# Google Drive file URL\n","file_url = 'https://drive.google.com/uc?id=1cl3UhRSTLQ3L4d4AdE1aWOqEak99nmri'\n","\n","# Local file path to save the downloaded file\n","file_path = \"cleaned_completed_data.csv\"\n","\n","# Download the file from Google Drive\n","gdown.download(file_url, file_path, quiet=False)\n","\n","# Get the current working directory (for information)\n","current_dir = os.getcwd()\n","print(f\"Current working directory: {current_dir}\")\n","\n","print(f\"Full file path: {file_path}\")\n","\n","# Now you can read the downloaded CSV file\n","df = pd.read_csv(file_path)\n","\n","# Display the first few rows\n","print(\"CSV Data Preview:\")\n","print(df.head())\n"]},{"cell_type":"code","execution_count":3,"id":"f441805f-2f6d-462f-9d13-fcc320b1c4ef","metadata":{"id":"f441805f-2f6d-462f-9d13-fcc320b1c4ef","outputId":"7944ffb6-1338-48c9-f190-ce54b09d9bf1","colab":{"base_uri":"https://localhost:8080/","height":342},"executionInfo":{"status":"ok","timestamp":1743096770081,"user_tz":300,"elapsed":92,"user":{"displayName":"Dereje Dimetros","userId":"13136209974486096002"}}},"outputs":[{"output_type":"execute_result","data":{"text/plain":["         date  index_sa  redfin_hpi_mom  case_shiller_index_mom  \\\n","0  2012-01-01      59.9             0.0               -0.000005   \n","1  2012-01-01      59.9             0.0               -0.000005   \n","2  2012-01-01      59.9             0.0               -0.000005   \n","3  2012-01-01      59.9             0.0               -0.000005   \n","4  2012-01-01      59.9             0.0               -0.000005   \n","\n","   period_duration region_type  table_id  is_seasonally_adjusted  \\\n","0               30       state        23                   False   \n","1               30       state        10                   False   \n","2               30       state        42                   False   \n","3               30       state        47                   False   \n","4               30       state        12                   False   \n","\n","          region          state  ... price_drops  price_drops_mom  \\\n","0       Oklahoma       Oklahoma  ...    0.000000         0.000000   \n","1  New Hampshire  New Hampshire  ...    0.000000         0.000000   \n","2       Virginia       Virginia  ...    0.000000         0.000000   \n","3       Michigan       Michigan  ...    0.000000         0.000000   \n","4     New Jersey     New Jersey  ...    0.000549         0.000005   \n","\n","   price_drops_yoy  off_market_in_two_weeks  off_market_in_two_weeks_mom  \\\n","0              0.0                 0.000000                     0.000000   \n","1              0.0                 0.007093                     0.000006   \n","2              0.0                 0.000000                     0.000000   \n","3              0.0                 0.013045                    -0.000005   \n","4              0.0                 0.007897                     0.000018   \n","\n","   off_market_in_two_weeks_yoy  30_year_%  price_drops_is_blank  \\\n","0                     0.000000      3.915                  True   \n","1                    -0.000002      3.915                  True   \n","2                     0.000000      3.915                  True   \n","3                     0.000007      3.915                  True   \n","4                     0.000061      3.915                 False   \n","\n","   price_drops_mom_is_blank  price_drops_yoy_is_blank  \n","0                      True                      True  \n","1                      True                      True  \n","2                      True                      True  \n","3                      True                      True  \n","4                     False                      True  \n","\n","[5 rows x 57 columns]"],"text/html":["\n","  <div id=\"df-b8ca5a2f-4e50-44f2-84db-4e304b4da9c6\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>date</th>\n","      <th>index_sa</th>\n","      <th>redfin_hpi_mom</th>\n","      <th>case_shiller_index_mom</th>\n","      <th>period_duration</th>\n","      <th>region_type</th>\n","      <th>table_id</th>\n","      <th>is_seasonally_adjusted</th>\n","      <th>region</th>\n","      <th>state</th>\n","      <th>...</th>\n","      <th>price_drops</th>\n","      <th>price_drops_mom</th>\n","      <th>price_drops_yoy</th>\n","      <th>off_market_in_two_weeks</th>\n","      <th>off_market_in_two_weeks_mom</th>\n","      <th>off_market_in_two_weeks_yoy</th>\n","      <th>30_year_%</th>\n","      <th>price_drops_is_blank</th>\n","      <th>price_drops_mom_is_blank</th>\n","      <th>price_drops_yoy_is_blank</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>2012-01-01</td>\n","      <td>59.9</td>\n","      <td>0.0</td>\n","      <td>-0.000005</td>\n","      <td>30</td>\n","      <td>state</td>\n","      <td>23</td>\n","      <td>False</td>\n","      <td>Oklahoma</td>\n","      <td>Oklahoma</td>\n","      <td>...</td>\n","      <td>0.000000</td>\n","      <td>0.000000</td>\n","      <td>0.0</td>\n","      <td>0.000000</td>\n","      <td>0.000000</td>\n","      <td>0.000000</td>\n","      <td>3.915</td>\n","      <td>True</td>\n","      <td>True</td>\n","      <td>True</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>2012-01-01</td>\n","      <td>59.9</td>\n","      <td>0.0</td>\n","      <td>-0.000005</td>\n","      <td>30</td>\n","      <td>state</td>\n","      <td>10</td>\n","      <td>False</td>\n","      <td>New Hampshire</td>\n","      <td>New Hampshire</td>\n","      <td>...</td>\n","      <td>0.000000</td>\n","      <td>0.000000</td>\n","      <td>0.0</td>\n","      <td>0.007093</td>\n","      <td>0.000006</td>\n","      <td>-0.000002</td>\n","      <td>3.915</td>\n","      <td>True</td>\n","      <td>True</td>\n","      <td>True</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>2012-01-01</td>\n","      <td>59.9</td>\n","      <td>0.0</td>\n","      <td>-0.000005</td>\n","      <td>30</td>\n","      <td>state</td>\n","      <td>42</td>\n","      <td>False</td>\n","      <td>Virginia</td>\n","      <td>Virginia</td>\n","      <td>...</td>\n","      <td>0.000000</td>\n","      <td>0.000000</td>\n","      <td>0.0</td>\n","      <td>0.000000</td>\n","      <td>0.000000</td>\n","      <td>0.000000</td>\n","      <td>3.915</td>\n","      <td>True</td>\n","      <td>True</td>\n","      <td>True</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>2012-01-01</td>\n","      <td>59.9</td>\n","      <td>0.0</td>\n","      <td>-0.000005</td>\n","      <td>30</td>\n","      <td>state</td>\n","      <td>47</td>\n","      <td>False</td>\n","      <td>Michigan</td>\n","      <td>Michigan</td>\n","      <td>...</td>\n","      <td>0.000000</td>\n","      <td>0.000000</td>\n","      <td>0.0</td>\n","      <td>0.013045</td>\n","      <td>-0.000005</td>\n","      <td>0.000007</td>\n","      <td>3.915</td>\n","      <td>True</td>\n","      <td>True</td>\n","      <td>True</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>2012-01-01</td>\n","      <td>59.9</td>\n","      <td>0.0</td>\n","      <td>-0.000005</td>\n","      <td>30</td>\n","      <td>state</td>\n","      <td>12</td>\n","      <td>False</td>\n","      <td>New Jersey</td>\n","      <td>New Jersey</td>\n","      <td>...</td>\n","      <td>0.000549</td>\n","      <td>0.000005</td>\n","      <td>0.0</td>\n","      <td>0.007897</td>\n","      <td>0.000018</td>\n","      <td>0.000061</td>\n","      <td>3.915</td>\n","      <td>False</td>\n","      <td>False</td>\n","      <td>True</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>5 rows × 57 columns</p>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-b8ca5a2f-4e50-44f2-84db-4e304b4da9c6')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-b8ca5a2f-4e50-44f2-84db-4e304b4da9c6 button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-b8ca5a2f-4e50-44f2-84db-4e304b4da9c6');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","<div id=\"df-cb2abecc-f32b-4747-8d93-2a2fc60a5381\">\n","  <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-cb2abecc-f32b-4747-8d93-2a2fc60a5381')\"\n","            title=\"Suggest charts\"\n","            style=\"display:none;\">\n","\n","<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","     width=\"24px\">\n","    <g>\n","        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n","    </g>\n","</svg>\n","  </button>\n","\n","<style>\n","  .colab-df-quickchart {\n","      --bg-color: #E8F0FE;\n","      --fill-color: #1967D2;\n","      --hover-bg-color: #E2EBFA;\n","      --hover-fill-color: #174EA6;\n","      --disabled-fill-color: #AAA;\n","      --disabled-bg-color: #DDD;\n","  }\n","\n","  [theme=dark] .colab-df-quickchart {\n","      --bg-color: #3B4455;\n","      --fill-color: #D2E3FC;\n","      --hover-bg-color: #434B5C;\n","      --hover-fill-color: #FFFFFF;\n","      --disabled-bg-color: #3B4455;\n","      --disabled-fill-color: #666;\n","  }\n","\n","  .colab-df-quickchart {\n","    background-color: var(--bg-color);\n","    border: none;\n","    border-radius: 50%;\n","    cursor: pointer;\n","    display: none;\n","    fill: var(--fill-color);\n","    height: 32px;\n","    padding: 0;\n","    width: 32px;\n","  }\n","\n","  .colab-df-quickchart:hover {\n","    background-color: var(--hover-bg-color);\n","    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n","    fill: var(--button-hover-fill-color);\n","  }\n","\n","  .colab-df-quickchart-complete:disabled,\n","  .colab-df-quickchart-complete:disabled:hover {\n","    background-color: var(--disabled-bg-color);\n","    fill: var(--disabled-fill-color);\n","    box-shadow: none;\n","  }\n","\n","  .colab-df-spinner {\n","    border: 2px solid var(--fill-color);\n","    border-color: transparent;\n","    border-bottom-color: var(--fill-color);\n","    animation:\n","      spin 1s steps(1) infinite;\n","  }\n","\n","  @keyframes spin {\n","    0% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","      border-left-color: var(--fill-color);\n","    }\n","    20% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    30% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","      border-right-color: var(--fill-color);\n","    }\n","    40% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    60% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","    }\n","    80% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-bottom-color: var(--fill-color);\n","    }\n","    90% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","    }\n","  }\n","</style>\n","\n","  <script>\n","    async function quickchart(key) {\n","      const quickchartButtonEl =\n","        document.querySelector('#' + key + ' button');\n","      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.\n","      quickchartButtonEl.classList.add('colab-df-spinner');\n","      try {\n","        const charts = await google.colab.kernel.invokeFunction(\n","            'suggestCharts', [key], {});\n","      } catch (error) {\n","        console.error('Error during call to suggestCharts:', error);\n","      }\n","      quickchartButtonEl.classList.remove('colab-df-spinner');\n","      quickchartButtonEl.classList.add('colab-df-quickchart-complete');\n","    }\n","    (() => {\n","      let quickchartButtonEl =\n","        document.querySelector('#df-cb2abecc-f32b-4747-8d93-2a2fc60a5381 button');\n","      quickchartButtonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","    })();\n","  </script>\n","</div>\n","\n","    </div>\n","  </div>\n"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"dataframe","variable_name":"df"}},"metadata":{},"execution_count":3}],"source":["df.head()"]},{"cell_type":"code","execution_count":4,"id":"fc867b7e-3afd-45b6-8711-4cbf53b7f5ec","metadata":{"id":"fc867b7e-3afd-45b6-8711-4cbf53b7f5ec","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1743096810247,"user_tz":300,"elapsed":40169,"user":{"displayName":"Dereje Dimetros","userId":"13136209974486096002"}},"outputId":"3f1333e7-06e0-4211-a2bd-8b959f91c74e"},"outputs":[{"output_type":"stream","name":"stdout","text":["root\n"," |-- date: date (nullable = true)\n"," |-- index_sa: double (nullable = true)\n"," |-- redfin_hpi_mom: double (nullable = true)\n"," |-- case_shiller_index_mom: double (nullable = true)\n"," |-- period_duration: integer (nullable = true)\n"," |-- region_type: string (nullable = true)\n"," |-- table_id: integer (nullable = true)\n"," |-- is_seasonally_adjusted: boolean (nullable = true)\n"," |-- region: string (nullable = true)\n"," |-- state: string (nullable = true)\n"," |-- property_type: string (nullable = true)\n"," |-- median_sale_price: integer (nullable = true)\n"," |-- median_sale_price_mom: double (nullable = true)\n"," |-- median_sale_price_yoy: double (nullable = true)\n"," |-- median_list_price: double (nullable = true)\n"," |-- median_list_price_mom: double (nullable = true)\n"," |-- median_list_price_yoy: double (nullable = true)\n"," |-- median_ppsf: double (nullable = true)\n"," |-- median_ppsf_mom: double (nullable = true)\n"," |-- median_ppsf_yoy: double (nullable = true)\n"," |-- median_list_ppsf: double (nullable = true)\n"," |-- median_list_ppsf_mom: double (nullable = true)\n"," |-- median_list_ppsf_yoy: double (nullable = true)\n"," |-- homes_sold: integer (nullable = true)\n"," |-- homes_sold_mom: double (nullable = true)\n"," |-- homes_sold_yoy: double (nullable = true)\n"," |-- pending_sales: double (nullable = true)\n"," |-- pending_sales_mom: double (nullable = true)\n"," |-- pending_sales_yoy: double (nullable = true)\n"," |-- new_listings: double (nullable = true)\n"," |-- new_listings_mom: double (nullable = true)\n"," |-- new_listings_yoy: double (nullable = true)\n"," |-- inventory: double (nullable = true)\n"," |-- inventory_mom: double (nullable = true)\n"," |-- inventory_yoy: double (nullable = true)\n"," |-- months_of_supply: double (nullable = true)\n"," |-- months_of_supply_mom: double (nullable = true)\n"," |-- months_of_supply_yoy: double (nullable = true)\n"," |-- median_dom: double (nullable = true)\n"," |-- median_dom_mom: double (nullable = true)\n"," |-- median_dom_yoy: double (nullable = true)\n"," |-- avg_sale_to_list: double (nullable = true)\n"," |-- avg_sale_to_list_mom: double (nullable = true)\n"," |-- avg_sale_to_list_yoy: double (nullable = true)\n"," |-- sold_above_list: double (nullable = true)\n"," |-- sold_above_list_mom: double (nullable = true)\n"," |-- sold_above_list_yoy: double (nullable = true)\n"," |-- price_drops: double (nullable = true)\n"," |-- price_drops_mom: double (nullable = true)\n"," |-- price_drops_yoy: double (nullable = true)\n"," |-- off_market_in_two_weeks: double (nullable = true)\n"," |-- off_market_in_two_weeks_mom: double (nullable = true)\n"," |-- off_market_in_two_weeks_yoy: double (nullable = true)\n"," |-- 30_year_%: double (nullable = true)\n"," |-- price_drops_is_blank: boolean (nullable = true)\n"," |-- price_drops_mom_is_blank: boolean (nullable = true)\n"," |-- price_drops_yoy_is_blank: boolean (nullable = true)\n","\n","+----------+--------+--------------+----------------------+---------------+-----------+--------+----------------------+-------------+-------------+--------------------+-----------------+---------------------+---------------------+-----------------+---------------------+---------------------+-----------+--------------------+--------------------+----------------+--------------------+--------------------+----------+--------------------+--------------------+-------------+--------------------+--------------------+------------+--------------------+--------------------+---------+--------------------+--------------------+----------------+--------------------+--------------------+----------+--------------+--------------+------------------+--------------------+--------------------+------------------+--------------------+-------------------+----------------+-----------------+---------------+-----------------------+---------------------------+---------------------------+---------+--------------------+------------------------+------------------------+\n","|      date|index_sa|redfin_hpi_mom|case_shiller_index_mom|period_duration|region_type|table_id|is_seasonally_adjusted|       region|        state|       property_type|median_sale_price|median_sale_price_mom|median_sale_price_yoy|median_list_price|median_list_price_mom|median_list_price_yoy|median_ppsf|     median_ppsf_mom|     median_ppsf_yoy|median_list_ppsf|median_list_ppsf_mom|median_list_ppsf_yoy|homes_sold|      homes_sold_mom|      homes_sold_yoy|pending_sales|   pending_sales_mom|   pending_sales_yoy|new_listings|    new_listings_mom|    new_listings_yoy|inventory|       inventory_mom|       inventory_yoy|months_of_supply|months_of_supply_mom|months_of_supply_yoy|median_dom|median_dom_mom|median_dom_yoy|  avg_sale_to_list|avg_sale_to_list_mom|avg_sale_to_list_yoy|   sold_above_list| sold_above_list_mom|sold_above_list_yoy|     price_drops|  price_drops_mom|price_drops_yoy|off_market_in_two_weeks|off_market_in_two_weeks_mom|off_market_in_two_weeks_yoy|30_year_%|price_drops_is_blank|price_drops_mom_is_blank|price_drops_yoy_is_blank|\n","+----------+--------+--------------+----------------------+---------------+-----------+--------+----------------------+-------------+-------------+--------------------+-----------------+---------------------+---------------------+-----------------+---------------------+---------------------+-----------+--------------------+--------------------+----------------+--------------------+--------------------+----------+--------------------+--------------------+-------------+--------------------+--------------------+------------+--------------------+--------------------+---------+--------------------+--------------------+----------------+--------------------+--------------------+----------+--------------+--------------+------------------+--------------------+--------------------+------------------+--------------------+-------------------+----------------+-----------------+---------------+-----------------------+---------------------------+---------------------------+---------+--------------------+------------------------+------------------------+\n","|2012-01-01|    59.9|           0.0|               -4.8E-6|             30|      state|      23|                 false|     Oklahoma|     Oklahoma|           Townhouse|            87200| -0.00383786483979...| -0.00514683153013...|         130000.0|  8.42368640533777E-4| -3.63232023721274E-4|       18.0|-0.00316511703146...|-0.00292713453291632|            76.0| 7.97117067576551E-4|-2.65183744580852...|         9|-0.00181818181818...|                 0.0|          9.0|-0.00181818181818...|                 0.0|         6.0|                0.01|-0.00142857142857...|     17.0|-0.00105263157894...|-0.00392857142857...|             1.9|0.001999999999999999|-0.01200000000000...|      14.0|         -0.05|         -0.94|0.9302420431048024|-3.53365018605132E-4|-2.27314547174923E-4|               0.0|-0.00181818181818...|                0.0|             0.0|              0.0|            0.0|                    0.0|                        0.0|                        0.0|    3.915|                true|                    true|                    true|\n","|2012-01-01|    59.9|           0.0|               -4.8E-6|             30|      state|      10|                 false|New Hampshire|New Hampshire|     All Residential|           184000| -1.73976610967446E-4| -2.86861258824177E-4|         199300.0| 0.001313254597175108|  3.43174775093182E-4|      111.0|3.091425192293480...| 1.80140681840277E-4|           114.0| 7.11625435956733E-4|-1.86075166551323E-4|       851|-0.00277589134125...|0.001754143646408838|        851.0|-0.00277589134125...|0.001786703601108032|      1160.0|0.004572864321608041|0.001451135241855874|   6193.0| 4.80622778811981E-4|               0.001|             7.3|               0.023|              -0.005|     148.0|          0.05|          0.02|0.9484366647759208|  3.2247275359973E-5|4.329255197392799...|0.1468860164512338|-5.91534178306150...|1.01456849595211E-4|             0.0|              0.0|            0.0|     0.0070930999458398|          6.364103833546E-6|         -2.398354412948E-6|    3.915|                true|                    true|                    true|\n","|2012-01-01|    59.9|           0.0|               -4.8E-6|             30|      state|      42|                 false|     Virginia|     Virginia|Multi-Family (2-4...|            40000| -0.00813084112149...| -0.00806060606060606|         153700.0| 0.004724337787996359|  4.56137963876321E-4|       17.0|-0.00807857186158558|-0.00785237753943...|            98.0| 0.00325610632183908| -7.5201193838939E-5|         7|0.013333333333333338|            -0.00125|          7.0|0.013333333333333338|            -0.00125|        21.0|             0.01625|0.013333333333333338|     56.0|0.003658536585365...|0.001428571428571427|             8.0|-0.05699999999999...|0.019000000000000003|      28.0|          0.22|          0.07|0.8790858742659445|-5.88885487975295E-4|-3.74067899617493...|0.1428571428571428|0.001428571428571428|1.78571428571428E-4|             0.0|              0.0|            0.0|                    0.0|                        0.0|                        0.0|    3.915|                true|                    true|                    true|\n","|2012-01-01|    59.9|           0.0|               -4.8E-6|             30|      state|      47|                 false|     Michigan|     Michigan|     All Residential|            79900| -9.24556062961744E-4|  -7.5983835670568E-5|          94900.0| 0.002318475161209...| 0.001079728639410311|       55.0|-5.96173723853948E-4|2.850278231118889...|            65.0|0.001722545788644822|7.494892121795479E-4|      5949|-0.00173405585660...|0.001506769825918761|       5795.0|-0.00174266172698...|0.001562250598563448|      8782.0|0.003271875472268399| 2.42593888500115E-4|  40283.0|  -7.937492248543E-6|-0.00167620621965...|             6.8|0.012000000000000002|-0.02600000000000...|     107.0|         -0.03|         -0.17|0.9435044236927131|   7.257640927048E-6|  5.6162720598864E-5|0.1884350310976634|8.915786968164999E-5|1.10655920260967E-4|             0.0|              0.0|            0.0|     0.0130450033121887|         -5.284843943044E-6|            7.3412703626E-6|    3.915|                true|                    true|                    true|\n","|2012-01-01|    59.9|           0.0|               -4.8E-6|             30|      state|      12|                 false|   New Jersey|   New Jersey|     All Residential|           247000| -4.13265389941303...| -5.11498490152435E-4|         283700.0| 0.001660579900319...| 1.034326429304580...|      148.0|-3.46361205188777E-4|-5.00250345455443E-4|           170.0|0.001016678054391078|  6.7821247978259E-5|      2005|-0.00235316552250...| 9.14534567229177E-4|       1987.0|-0.00233706131893...|9.779005524861882E-4|      4217.0|0.009623080502559328|0.001674972314507199|  21845.0| 3.13488503847787E-4|-3.21651676930574E-4|            10.9|0.028000000000000008|-0.01400000000000...|     161.0|          0.11|          0.12|0.9256808794939592| -3.8767770819124E-5|-7.61494637822690...| 0.054862842892768|-3.10817159998549...|-7.7392256973244E-5|5.49324788281E-4|5.021126642076E-6|            0.0|     0.0078966821742233|         1.8321541926708E-5|          6.059858825969E-5|    3.915|               false|                   false|                    true|\n","+----------+--------+--------------+----------------------+---------------+-----------+--------+----------------------+-------------+-------------+--------------------+-----------------+---------------------+---------------------+-----------------+---------------------+---------------------+-----------+--------------------+--------------------+----------------+--------------------+--------------------+----------+--------------------+--------------------+-------------+--------------------+--------------------+------------+--------------------+--------------------+---------+--------------------+--------------------+----------------+--------------------+--------------------+----------+--------------+--------------+------------------+--------------------+--------------------+------------------+--------------------+-------------------+----------------+-----------------+---------------+-----------------------+---------------------------+---------------------------+---------+--------------------+------------------------+------------------------+\n","only showing top 5 rows\n","\n"]}],"source":["from pyspark.sql import SparkSession\n","\n","# Start or get Spark session\n","spark = SparkSession.builder \\\n","    .appName(\"HousingDataAnalysis\") \\\n","    .getOrCreate()\n","\n","# Load the CSV file\n","file_path = \"cleaned_completed_data.csv\"\n","# Read the CSV directly using the absolute path\n","df = spark.read.csv(file_path, header=True, inferSchema=True)\n","\n","# Quick preview\n","df.printSchema()\n","df.show(5)"]},{"cell_type":"code","execution_count":5,"id":"b6bc3364-6294-4168-8926-736f3714cfec","metadata":{"id":"b6bc3364-6294-4168-8926-736f3714cfec","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1743096813130,"user_tz":300,"elapsed":2882,"user":{"displayName":"Dereje Dimetros","userId":"13136209974486096002"}},"outputId":"4fcaa5f2-dd5c-46dc-fe02-f6d81f41496d"},"outputs":[{"output_type":"stream","name":"stdout","text":["+------------+--------------+\n","|       state|max_sale_price|\n","+------------+--------------+\n","|     Wyoming|       3275000|\n","|       Maine|       2700000|\n","|      Hawaii|       2359600|\n","|North Dakota|       1847600|\n","|    Colorado|       1608900|\n","|    New York|       1392100|\n","|     Alabama|       1352500|\n","|    Columbia|       1340500|\n","|     Montana|       1192000|\n","|    Oklahoma|       1152900|\n","+------------+--------------+\n","only showing top 10 rows\n","\n"]}],"source":["#Max Sale Price per State\n","from pyspark.sql.functions import max\n","\n","df.groupBy(\"state\") \\\n","  .agg(max(\"median_sale_price\").alias(\"max_sale_price\")) \\\n","  .orderBy(\"max_sale_price\", ascending=False) \\\n","  .show(10)\n"]},{"cell_type":"code","source":["#Top 10 States – % Sold Above List Price\n","from pyspark.sql.functions import avg, round\n","\n","df.groupBy(\"state\") \\\n","  .agg(round(avg(\"sold_above_list\") * 100, 2).alias(\"avg_sold_above_list_percent\")) \\\n","  .orderBy(\"avg_sold_above_list_percent\", ascending=False) \\\n","  .limit(10) \\\n","  .show()\n"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"dkGyUITyTFZ-","executionInfo":{"status":"ok","timestamp":1743096815648,"user_tz":300,"elapsed":2500,"user":{"displayName":"Dereje Dimetros","userId":"13136209974486096002"}},"outputId":"fc2aa29b-04f0-48a0-fc33-ebacedb44a0e"},"id":"dkGyUITyTFZ-","execution_count":6,"outputs":[{"output_type":"stream","name":"stdout","text":["+-------------+---------------------------+\n","|        state|avg_sold_above_list_percent|\n","+-------------+---------------------------+\n","|   California|                      39.16|\n","|Massachusetts|                      37.16|\n","|New Hampshire|                      34.71|\n","|   Washington|                      32.03|\n","|     Columbia|                      31.83|\n","| Rhode Island|                      31.49|\n","|    Minnesota|                      30.54|\n","|  Connecticut|                      29.74|\n","|       Oregon|                      28.89|\n","|         Utah|                      28.16|\n","+-------------+---------------------------+\n","\n"]}]},{"cell_type":"code","source":["#Longest Days on Market by Region\n","df.groupBy(\"state\") \\\n","  .agg(max(\"median_dom\").alias(\"max_days_on_market\")) \\\n","  .orderBy(\"max_days_on_market\", ascending=False) \\\n","  .show(10)\n"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"UOrtLbQ29Ybg","executionInfo":{"status":"ok","timestamp":1743096816977,"user_tz":300,"elapsed":1331,"user":{"displayName":"Dereje Dimetros","userId":"13136209974486096002"}},"outputId":"4d1162ae-2eff-4b1f-ff51-c695581ca7bc"},"id":"UOrtLbQ29Ybg","execution_count":7,"outputs":[{"output_type":"stream","name":"stdout","text":["+--------------+------------------+\n","|         state|max_days_on_market|\n","+--------------+------------------+\n","|          Iowa|            2966.0|\n","|        Hawaii|            2783.0|\n","|North Carolina|            1771.0|\n","| West Virginia|            1569.0|\n","|     Louisiana|            1534.0|\n","|       Alabama|            1303.0|\n","|      Virginia|             986.0|\n","|     Tennessee|             924.0|\n","|       Wyoming|             826.0|\n","|      Arkansas|             803.0|\n","+--------------+------------------+\n","only showing top 10 rows\n","\n"]}]},{"cell_type":"code","source":["# Price Category by region\n","from pyspark.sql.functions import when\n","\n","\n","df.withColumn(\n","    \"price_category\",\n","    when(df[\"median_sale_price\"] > 750000, \"Luxury\")\n","    .when(df[\"median_sale_price\"] > 250000, \"Mid-Range\")\n","    .otherwise(\"Affordable\")\n",").select(\"region\", \"median_sale_price\", \"price_category\") \\\n"," .orderBy(\"price_category\", \"region\") \\\n"," .show(20, truncate=False)\n"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"0-imhF9k9gd9","executionInfo":{"status":"ok","timestamp":1743096818105,"user_tz":300,"elapsed":1117,"user":{"displayName":"Dereje Dimetros","userId":"13136209974486096002"}},"outputId":"058a9039-7bb1-4355-a327-96185f63c11b"},"id":"0-imhF9k9gd9","execution_count":8,"outputs":[{"output_type":"stream","name":"stdout","text":["+-------+-----------------+--------------+\n","|region |median_sale_price|price_category|\n","+-------+-----------------+--------------+\n","|Alabama|212600           |Affordable    |\n","|Alabama|47800            |Affordable    |\n","|Alabama|206800           |Affordable    |\n","|Alabama|183100           |Affordable    |\n","|Alabama|136200           |Affordable    |\n","|Alabama|141800           |Affordable    |\n","|Alabama|126800           |Affordable    |\n","|Alabama|144000           |Affordable    |\n","|Alabama|169300           |Affordable    |\n","|Alabama|123400           |Affordable    |\n","|Alabama|217600           |Affordable    |\n","|Alabama|122000           |Affordable    |\n","|Alabama|168100           |Affordable    |\n","|Alabama|150900           |Affordable    |\n","|Alabama|37500            |Affordable    |\n","|Alabama|84100            |Affordable    |\n","|Alabama|90500            |Affordable    |\n","|Alabama|150700           |Affordable    |\n","|Alabama|154600           |Affordable    |\n","|Alabama|100400           |Affordable    |\n","+-------+-----------------+--------------+\n","only showing top 20 rows\n","\n"]}]},{"cell_type":"code","source":["#Shortest Days on Market by Region\n","df.groupBy(\"state\") \\\n","  .agg(max(\"median_dom\").alias(\"max_days_on_market\")) \\\n","  .orderBy(\"max_days_on_market\") \\\n","  .show(10)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"JVt7EowS9rCA","executionInfo":{"status":"ok","timestamp":1743097168459,"user_tz":300,"elapsed":798,"user":{"displayName":"Dereje Dimetros","userId":"13136209974486096002"}},"outputId":"51500680-e136-412c-c432-a60e44bca89b"},"id":"JVt7EowS9rCA","execution_count":15,"outputs":[{"output_type":"stream","name":"stdout","text":["+-------------+------------------+\n","|        state|max_days_on_market|\n","+-------------+------------------+\n","|   California|              75.0|\n","|        Texas|              99.0|\n","|    Minnesota|             125.0|\n","|     Illinois|             139.0|\n","|     Oklahoma|             145.0|\n","|   Washington|             150.0|\n","|      Florida|             151.0|\n","| Rhode Island|             160.0|\n","|Massachusetts|             170.0|\n","|  Connecticut|             175.0|\n","+-------------+------------------+\n","only showing top 10 rows\n","\n"]}]},{"cell_type":"code","source":["#Average YoY % Change by State\n","from pyspark.sql.functions import avg, round\n","\n","df.groupBy(\"state\") \\\n","    .agg(round(avg(\"median_sale_price_yoy\") * 100, 2).alias(\"avg_yoy_percent\")) \\\n","    .orderBy(\"avg_yoy_percent\", ascending=False) \\\n","    .show(20, truncate=False)\n"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"IOhKNxNI99eu","executionInfo":{"status":"ok","timestamp":1743096819894,"user_tz":300,"elapsed":932,"user":{"displayName":"Dereje Dimetros","userId":"13136209974486096002"}},"outputId":"c0dd0ea9-dee3-4450-feb9-3f76336f53fe"},"id":"IOhKNxNI99eu","execution_count":10,"outputs":[{"output_type":"stream","name":"stdout","text":["+--------------+---------------+\n","|state         |avg_yoy_percent|\n","+--------------+---------------+\n","|Michigan      |0.14           |\n","|Alabama       |0.14           |\n","|Nevada        |0.13           |\n","|Georgia       |0.13           |\n","|Mississippi   |0.13           |\n","|West Virginia |0.12           |\n","|Wyoming       |0.12           |\n","|Arizona       |0.12           |\n","|Idaho         |0.12           |\n","|Maine         |0.12           |\n","|Tennessee     |0.11           |\n","|Florida       |0.11           |\n","|Utah          |0.1            |\n","|Hawaii        |0.1            |\n","|Delaware      |0.1            |\n","|South Carolina|0.1            |\n","|South Dakota  |0.1            |\n","|Ohio          |0.09           |\n","|Arkansas      |0.09           |\n","|Washington    |0.09           |\n","+--------------+---------------+\n","only showing top 20 rows\n","\n"]}]},{"cell_type":"code","source":["# Highest YoY Growth per State (Max Value)\n","from pyspark.sql.functions import max\n","\n","df.groupBy(\"state\") \\\n","    .agg(round(max(\"median_sale_price_yoy\") * 100, 2).alias(\"max_yoy_percent\")) \\\n","    .orderBy(\"max_yoy_percent\", ascending=False) \\\n","    .show(20, truncate=False)\n"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"V0fwm5tMB--4","executionInfo":{"status":"ok","timestamp":1743096820708,"user_tz":300,"elapsed":816,"user":{"displayName":"Dereje Dimetros","userId":"13136209974486096002"}},"outputId":"96ea5c2b-4e10-4956-f270-1e1b5cde274d"},"id":"V0fwm5tMB--4","execution_count":11,"outputs":[{"output_type":"stream","name":"stdout","text":["+--------------+---------------+\n","|state         |max_yoy_percent|\n","+--------------+---------------+\n","|Michigan      |12.57          |\n","|Alabama       |11.17          |\n","|North Dakota  |9.49           |\n","|West Virginia |8.06           |\n","|Maine         |5.55           |\n","|Delaware      |4.64           |\n","|Oklahoma      |4.61           |\n","|Vermont       |4.13           |\n","|Mississippi   |3.98           |\n","|Wyoming       |3.72           |\n","|Maryland      |3.69           |\n","|South Dakota  |3.55           |\n","|Virginia      |3.42           |\n","|Hawaii        |3.38           |\n","|New Mexico    |3.37           |\n","|Arkansas      |3.34           |\n","|Iowa          |2.9            |\n","|Louisiana     |2.87           |\n","|South Carolina|2.51           |\n","|Tennessee     |2.21           |\n","+--------------+---------------+\n","only showing top 20 rows\n","\n"]}]},{"cell_type":"code","source":["# Nationwide average yearly change in median sale price as a percentage\n","from pyspark.sql.functions import year, round, avg\n","\n","df.withColumn(\"year\", year(\"date\")) \\\n","    .groupBy(\"year\") \\\n","    .agg(round(avg(\"median_sale_price_yoy\") * 100, 2).alias(\"avg_yoy_percent\")) \\\n","    .orderBy(\"year\") \\\n","    .show(100, truncate=False)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"5BdWO2eCCqbY","executionInfo":{"status":"ok","timestamp":1743096822006,"user_tz":300,"elapsed":1296,"user":{"displayName":"Dereje Dimetros","userId":"13136209974486096002"}},"outputId":"48975987-16cb-45d8-ab03-6799448e5c40"},"id":"5BdWO2eCCqbY","execution_count":12,"outputs":[{"output_type":"stream","name":"stdout","text":["+----+---------------+\n","|year|avg_yoy_percent|\n","+----+---------------+\n","|2012|0.09           |\n","|2013|0.12           |\n","|2014|0.08           |\n","|2015|0.06           |\n","|2016|0.06           |\n","|2017|0.08           |\n","|2018|0.08           |\n","|2019|0.06           |\n","|2020|0.1            |\n","|2021|0.18           |\n","|2022|0.13           |\n","|2023|0.04           |\n","|2024|0.07           |\n","|2025|0.07           |\n","+----+---------------+\n","\n"]}]},{"cell_type":"code","source":["#Minnesota average yearly change in median sale price as a percentage\n","from pyspark.sql.functions import year, round\n","\n","df.filter(df[\"state\"] == \"Minnesota\") \\\n","    .withColumn(\"year\", year(\"date\")) \\\n","    .groupBy(\"year\") \\\n","    .agg(round(avg(\"median_sale_price_yoy\") * 100, 2).alias(\"avg_yoy_percent\")) \\\n","    .orderBy(\"year\") \\\n","    .show(20, truncate=False)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"kPKlNeEdmjt9","executionInfo":{"status":"ok","timestamp":1743096823079,"user_tz":300,"elapsed":1071,"user":{"displayName":"Dereje Dimetros","userId":"13136209974486096002"}},"outputId":"ae117cec-545d-4504-f120-3ed3f2375aac"},"id":"kPKlNeEdmjt9","execution_count":13,"outputs":[{"output_type":"stream","name":"stdout","text":["+----+---------------+\n","|year|avg_yoy_percent|\n","+----+---------------+\n","|2012|0.11           |\n","|2013|0.17           |\n","|2014|0.09           |\n","|2015|0.05           |\n","|2016|0.06           |\n","|2017|0.07           |\n","|2018|0.1            |\n","|2019|0.07           |\n","|2020|0.06           |\n","|2021|0.1            |\n","|2022|0.06           |\n","|2023|0.02           |\n","|2024|0.03           |\n","|2025|0.03           |\n","+----+---------------+\n","\n"]}]},{"cell_type":"code","source":["# Current invetory by catagory\n","from pyspark.sql.functions import when, sum, max\n","\n","#Get latest date\n","latest_date = df.agg(max(\"date\")).collect()[0][0]\n","\n","#Add price category column\n","categorized_df = df.withColumn(\n","    \"price_category\",\n","    when(df[\"median_sale_price\"] > 750000, \"Luxury\")\n","    .when(df[\"median_sale_price\"] > 300000, \"Mid-Range\")\n","    .otherwise(\"Affordable\")\n",")\n","\n","# Filter for latest date only\n","latest_df = categorized_df.filter(categorized_df[\"date\"] == latest_date)\n","\n","# Group by region and SUM inventory for each category\n","latest_df.groupBy(\"state\") \\\n","    .agg(\n","        sum(\"inventory\").alias(\"current_inventory\"),\n","        sum(when(latest_df[\"price_category\"] == \"Luxury\", latest_df[\"inventory\"]).otherwise(0)).alias(\"Luxury_inventory\"),\n","        sum(when(latest_df[\"price_category\"] == \"Mid-Range\", latest_df[\"inventory\"]).otherwise(0)).alias(\"Mid_Range_inventory\"),\n","        sum(when(latest_df[\"price_category\"] == \"Affordable\", latest_df[\"inventory\"]).otherwise(0)).alias(\"Affordable_inventory\")\n","    ) \\\n","    .orderBy(\"current_inventory\", ascending=False) \\\n","    .limit(20) \\\n","    .show(truncate=False)\n","\n"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"mHuexbTNn1Ha","executionInfo":{"status":"ok","timestamp":1743103743020,"user_tz":300,"elapsed":1487,"user":{"displayName":"Dereje Dimetros","userId":"13136209974486096002"}},"outputId":"0e0bf475-0e24-45f9-e742-289cc9d21d48"},"id":"mHuexbTNn1Ha","execution_count":31,"outputs":[{"output_type":"stream","name":"stdout","text":["+--------------+-----------------+----------------+-------------------+--------------------+\n","|state         |current_inventory|Luxury_inventory|Mid_Range_inventory|Affordable_inventory|\n","+--------------+-----------------+----------------+-------------------+--------------------+\n","|Florida       |352544.0         |0.0             |352544.0           |0.0                 |\n","|Texas         |217685.0         |0.0             |212404.0           |5281.0              |\n","|California    |91564.0          |83440.0         |8124.0             |0.0                 |\n","|North Carolina|70143.0          |0.0             |70143.0            |0.0                 |\n","|Georgia       |70037.0          |0.0             |70037.0            |0.0                 |\n","|Arizona       |66607.0          |0.0             |66607.0            |0.0                 |\n","|New York      |55498.0          |1269.0          |54229.0            |0.0                 |\n","|Tennessee     |53293.0          |0.0             |53084.0            |209.0               |\n","|Illinois      |49356.0          |0.0             |3194.0             |46162.0             |\n","|South Carolina|46989.0          |0.0             |43051.0            |3938.0              |\n","|Pennsylvania  |42369.0          |0.0             |13050.0            |29319.0             |\n","|Ohio          |41465.0          |0.0             |224.0              |41241.0             |\n","|Colorado      |39794.0          |296.0           |39498.0            |0.0                 |\n","|Alabama       |35237.0          |0.0             |1316.0             |33921.0             |\n","|Michigan      |33931.0          |0.0             |0.0                |33931.0             |\n","|Virginia      |30155.0          |0.0             |30155.0            |0.0                 |\n","|New Jersey    |28878.0          |0.0             |28878.0            |0.0                 |\n","|Oklahoma      |24526.0          |0.0             |61.0               |24465.0             |\n","|Washington    |24505.0          |0.0             |24505.0            |0.0                 |\n","|Indiana       |23972.0          |0.0             |0.0                |23972.0             |\n","+--------------+-----------------+----------------+-------------------+--------------------+\n","\n"]}]},{"cell_type":"code","source":["#Total home sold nation wide from 2012 - 2025\n","from pyspark.sql.functions import year, sum\n","\n","df.withColumn(\"year\", year(\"date\")) \\\n","    .groupBy(\"year\") \\\n","    .agg(sum(\"homes_sold\").alias(\"total_homes_sold\")) \\\n","    .orderBy(\"year\") \\\n","    .show()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"zeIhkoGar-4H","executionInfo":{"status":"ok","timestamp":1743099536551,"user_tz":300,"elapsed":1926,"user":{"displayName":"Dereje Dimetros","userId":"13136209974486096002"}},"outputId":"c06eab6c-97e0-44bb-dddf-74883eb51c2c"},"id":"zeIhkoGar-4H","execution_count":16,"outputs":[{"output_type":"stream","name":"stdout","text":["+----+----------------+\n","|year|total_homes_sold|\n","+----+----------------+\n","|2012|         5166758|\n","|2013|         5927669|\n","|2014|         6412883|\n","|2015|         7303800|\n","|2016|         8137507|\n","|2017|         8515780|\n","|2018|         8496504|\n","|2019|         8653477|\n","|2020|         9230602|\n","|2021|        10144682|\n","|2022|         8492959|\n","|2023|         7043804|\n","|2024|         7120271|\n","|2025|          876902|\n","+----+----------------+\n","\n"]}]},{"cell_type":"code","source":["#Total home sold by state in year 2021(top 10)\n","from pyspark.sql.functions import year, sum\n","\n","\n","df.withColumn(\"year\", year(\"date\")) \\\n","    .filter(\"year = 2021\") \\\n","    .groupBy(\"state\") \\\n","    .agg(sum(\"homes_sold\").alias(\"total_homes_sold_2021\")) \\\n","    .orderBy(\"total_homes_sold_2021\", ascending=False) \\\n","    .limit(10) \\\n","    .show(truncate=False)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"1hJCAwaF1Byi","executionInfo":{"status":"ok","timestamp":1743099773632,"user_tz":300,"elapsed":2355,"user":{"displayName":"Dereje Dimetros","userId":"13136209974486096002"}},"outputId":"55074950-30e3-4882-ed8d-cab9c458fc9a"},"id":"1hJCAwaF1Byi","execution_count":19,"outputs":[{"output_type":"stream","name":"stdout","text":["+--------------+---------------------+\n","|state         |total_homes_sold_2021|\n","+--------------+---------------------+\n","|Florida       |1081708              |\n","|California    |886079               |\n","|Texas         |810328               |\n","|North Carolina|402213               |\n","|Illinois      |397742               |\n","|Georgia       |366856               |\n","|New York      |364951               |\n","|Pennsylvania  |339238               |\n","|Ohio          |335719               |\n","|Virginia      |324952               |\n","+--------------+---------------------+\n","\n"]}]},{"cell_type":"code","source":[],"metadata":{"id":"iMqZZNP51Ywu"},"id":"iMqZZNP51Ywu","execution_count":null,"outputs":[]}],"metadata":{"kernelspec":{"display_name":"Python 3 (ipykernel)","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.12.7"},"colab":{"provenance":[]}},"nbformat":4,"nbformat_minor":5}